# PostgreSQL Notes (Converted from MySQL-style Queries)

## Docker Setup

### PostgreSQL

```bash
docker stop postgres-db && docker rm postgres-db

docker pull postgres:17-alpine

docker run -d --name postgres-db -e POSTGRES_DB=lmsdb -e POSTGRES_USER=root -e POSTGRES_PASSWORD=1234 -p 5432:5432 -v pg_data:/var/lib/postgresql/data postgres:17-alpine

docker exec -it postgres-db psql -U root -d lmsdb


docker start postgres-db
docker logs postgres-db
docker container prune
docker ps -a
docker volume ls
docker rm -f postgres-db

docker run -d --name pgadmin -e PGADMIN_DEFAULT_EMAIL=user@domain.com -e PGADMIN_DEFAULT_PASSWORD=SuperSecret dpage/pgadmin4


```

```bash
  //delete all the network 
  docker network prune
  //create network
 docker network create my-network
 docker rm -f postgres-db pgadmin

 docker exec -it pgadmin ping postgres-db
```

## Comments

- Single-line comment: `-- comment`
- Multi-line comment: `/* comment */`
- PostgreSQL does **not** support `#` comments.

---

## Database Operations

```sql
SELECT datname FROM pg_database;
CREATE DATABASE amandb;
DROP DATABASE amandb;
```

- **psql only** ` \c amandb `

---

## psql Useful Commands

- `\l` → list databases
- `\dt` → list tables
- `\d table_name` → describe table
- `\! clear` → for clearing the console in pgsql

---

## MySQL → PostgreSQL Data Type Mapping

| MySQL | PostgreSQL | Description | Example |
|---|---|---|---|
| TINYINT | SMALLINT | Small integers | `SMALLINT` (-32768 to 32767) |
| SMALLINT | SMALLINT | Small integers | `SMALLINT` |
| MEDIUMINT | INTEGER | Standard integers | `INTEGER` |
| INT | INTEGER | Standard integers | `INTEGER` |
| BIGINT | BIGINT | Large integers | `BIGINT` |
| FLOAT | REAL | Single precision decimal | `REAL` |
| DOUBLE | DOUBLE PRECISION | Double precision decimal | `DOUBLE PRECISION` |
| DECIMAL | NUMERIC | Fixed-point numbers | `NUMERIC(10,2)` |
| CHAR | CHAR | Fixed-length string | `CHAR(10)` |
| VARCHAR | VARCHAR | Variable-length string | `VARCHAR(255)` |
| TEXT variants | TEXT | Unlimited text | `TEXT` |
| DATE | DATE | Date only | `DATE '2024-01-15'` |
| DATETIME | TIMESTAMP | Date and time | `TIMESTAMP '2024-01-15 10:30:00'` |
| TIMESTAMP | TIMESTAMP / TIMESTAMPTZ | Timezone-aware timestamp | `TIMESTAMPTZ` |
| YEAR | INTEGER | Year value | `INTEGER` (1901-2155) |

## Table Creation Examples

```sql
CREATE TABLE table_name (
  col0 BIT,
  col1 SMALLINT,
  col2 INTEGER,
  col3 BIGINT,
  col4 BOOLEAN
);
```

```sql
CREATE TABLE table_name2 (
  col1 REAL,
  col2 DOUBLE PRECISION,
  col3 NUMERIC(5,2)
);
```

---

## CRUD Operations

```sql
CREATE TABLE stu ( rollno INTEGER );
INSERT INTO stu VALUES (101), (102), (103);
SELECT * FROM stu;
```

### Alter Table

```sql
ALTER TABLE stu ADD COLUMN phone VARCHAR(50);
ALTER TABLE stu ALTER COLUMN phone TYPE INTEGER;
ALTER TABLE stu RENAME COLUMN phone TO mobilephone;
ALTER TABLE stu RENAME TO students_details;
```

---

## Insert Patterns

```sql
INSERT INTO employee23 VALUES (21, 'Aman', '1999-04-22');
INSERT INTO employee23 (name) VALUES ('abcd');
```

```sql
INSERT INTO employee23 (id, name)
SELECT customernumber, customername
FROM classicmodels.customers;
```

---

## WHERE Clause & Operators

```sql
SELECT * FROM mycustomers WHERE creditlimit > 10000;
SELECT * FROM mycustomers WHERE creditlimit <> 11000;
SELECT * FROM mycustomers WHERE customername LIKE 'R%';
```

---

## Constraints

### Primary Key & Default

```sql
CREATE TABLE students (
  roll INTEGER PRIMARY KEY,
  customer_id VARCHAR(255),
  city VARCHAR(255) DEFAULT 'Delhi'
);
```

### Composite Key

```sql
CREATE TABLE students_ck (
  stu_name VARCHAR(255),
  father_name VARCHAR(255),
  city VARCHAR(255),
  CONSTRAINT myrule PRIMARY KEY (stu_name, father_name)
);
```

---

## Foreign Key with Cascading

```sql
CREATE TABLE categories (
  cat_id INTEGER PRIMARY KEY,
  cat_name VARCHAR(255)
);

CREATE TABLE products (
  category_id INTEGER,
  pro_id INTEGER PRIMARY KEY,
  CONSTRAINT fk_cat FOREIGN KEY (category_id)
  REFERENCES categories(cat_id)
  ON UPDATE CASCADE
  ON DELETE CASCADE
);
```

- Two modes

```sql
GENERATED ALWAYS AS IDENTITY
GENERATED BY DEFAULT AS IDENTITY
```

- Mode Meaning
  - ALWAYS -> DB always generates value
  - BY DEFAULT -> You may insert your own value

---

```sql
CREATE TABLE students (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE,
    gender CHAR(1) CHECK (gender IN ('M','F','O')),
    fee NUMERIC(10,2) CHECK (fee >= 0),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ,
    CONSTRAINT students_pk PRIMARY KEY (id)
);
CREATE OR REPLACE FUNCTION set_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
CREATE TRIGGER trg_students_updated_at
BEFORE UPDATE ON students
FOR EACH ROW
EXECUTE FUNCTION set_updated_at();

```

## Best Practices

- Prefer `TIMESTAMPTZ` for time-sensitive data
- Use `NUMERIC` for money
- Use `TEXT` unless strict length is required
- Prefer `IDENTITY` columns for auto-increment

---

## Redis

```bash
docker pull redis/redis-stack:latest
docker run -d --name redis-stack -p 6379:6379 -p 8001:8001 redis/redis-stack:latest

docker exec -it redis-stack redis-cli
```



```bash
create a docker network
docker network create postgres

start the  postgresql service
docker run -d
--name postgres-db
-e POSTGRES_DB=lmsdb
-e POSTGRES_USER=root
-e POSTGRES_PASSWORD=1234
-e PGDATA=/data/postgres
-v postgres:/data/postgres
-p 5432:5432
--network postgres
--restart unless-stopped
postgres:17-alpine

start the pgadmin service
docker run -d 
--name pgadmin 
-e PGADMIN_DEFAULT_EMAIL=user@domain.com 
-e PGADMIN_DEFAULT_PASSWORD=1234
-e PGADMIN_CONFIG_SERVER_MODE=False
-v pgadmin:/var/lib/pgadmin
-p 5050:80
--network postgres
--restart unless-stopped
 dpage/pgadmin4


```

```bash 
docker run -d --name postgres-db --network my-network -e POSTGRES_DB=lmsdb -e POSTGRES_USER=root -e POSTGRES_PASSWORD=1234 -p 5432:5432 -v pg_data:/var/lib/postgresql/data postgres:17-alpine


docker run -d --name pgadmin --network my-network -p 5050:80 -e PGADMIN_DEFAULT_EMAIL=user@gmail.com -e PGADMIN_DEFAULT_PASSWORD=1234 dpage/pgadmin4


```

